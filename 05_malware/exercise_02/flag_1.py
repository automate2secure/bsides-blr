import pyshark


def extract_http_headers(pcap_file):
    # Open the PCAP file using PyShark
    cap = pyshark.FileCapture(pcap_file, display_filter="http")

    # Iterate through the packets
    for packet in cap:
        try:
            if "HTTP" in packet and hasattr(packet.http, "response_code"):
                if hasattr(packet, "http"):
                    http_layer = packet.http
                    tmp_value = []
                    found_flag = False
                    for value in http_layer._get_all_field_lines():
                        strip_value = value.strip().strip("\n")
                        if strip_value:
                            if "bsidesbangalore" in strip_value.lower():
                                found_flag = True
                            tmp_value.append(strip_value)

                    if found_flag:
                        print(tmp_value)

        except AttributeError:
            continue


# Replace with your pcap file path
pcap_file = "./ctf_traffic.pcap"
extract_http_headers(pcap_file)
